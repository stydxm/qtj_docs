# （二）软件安装+环境配置+新建工程一步到位

课程提要：本教程介绍了两种常用的工具链，学员可以根据自己的开发习惯选择合适的开发环境。

# 1. 基于 Keil+CubeMX+Vscode的工具链搭建

## 1.1 软件下载和安装

**注意！！！安装路径不能存在中文！！！**

1.1.1 Keil安装和激活

Keil_MDK下载地址（建议安装最新版软件）：

[MDK-ARM Version 5.39 Evaluation Software Request (keil.com)](https://www.keil.com/demo/eval/arm.htm)

Keil软件需要先安装后激活，

激活教程如下：

[STM32学习笔记——二、Keil5等软件安装、配置、程序烧录_keil用jtag烧录程序-CSDN博客](https://blog.csdn.net/weixin_45029825/article/details/132386037?ops_request_misc=&request_id=&biz_id=102&utm_term=keil%20%E6%BF%80%E6%B4%BB&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-8-132386037.142^v100^pc_search_result_base8&spm=1018.2226.3001.4187#21Keil_10)

1.1.2 STM32CubeMX 安装

STM32CubeMX 是 ST 意法半导体近几年来大力推荐的STM32 芯片图形化配置工具，目的就是为了方便开发者，允许用户使用图形化向导生成C 初始化代码，可以大大减轻开发工作，时间和费用，提高开发效率。STM32CubeMX几乎覆盖了STM32 全系列芯片。

## 1.2 新建工程

1.打开STM32CubeMX软件，点击“ACCESS TO MCU SELECTOR”；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/10a94d72-5acb-4fa6-9730-19abe61fa169.png)

2.选择对应型号STM32芯片，开发板C型使用的是STM32F407IGH6，故选择STM32F407IGHx。选择完毕后点击“Start Project”；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled.png)

3.在 System Core 下选择 RCC 选项，在 RCC mode and Configuration 中的 High Speed Clock(HSE)下选择 Crystal/Ceramic Resonator；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/b1113db4-2176-4e4d-8698-97e7cb61946d.png)

4.点击顶部的 Clock Configuration，进行主频配置；将 Input frequecncy 设置为 12，点击旁边的 HSE 圆形按钮，配置/M 为/6，配置*N 为 X168，配置/P 为/2 ，选择 PLLCLK 圆形按钮，配置 APB1 Prescaler 为/4，配置 APB2 Prescaler 为/2；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%201.png)

5.我们一般常用 STLink或者是DAPLink作为调试器，故单片机调试方式选择串行总线。操作如下：点击顶部的 Pinout & Configuartion，选择 SYS，在 Debug 下拉框中选择 Serial Wire；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%202.png)

6.点击顶部的 Project Manager，给工程起名，选择存放目录，在 Toolchain/IDE 中选择 MDK-ARM V5；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%203.png)

7.点击旁边的 Code Generator，勾选 Copy only the necessary library files 以及 Generate peripheral initialization as a pair of ‘.c/.h’ files per peripheral，最后点击顶部的 GENERATE CODE，等待代码生成，打开工程。；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%204.png)

8.找到步骤6中自定义的文件目录。可看见STM32CubeMX生成的工程文件架构如下：

Core ：存放源文件和头文件，里面包括main.c/h 等文件；

Drivers ：存放HAL库文件和驱动文件；

MDK-ARM：存放Keil编辑器有关文件；

.ioc文件：CubeMX配置，可以直接用CubeMX软件打开，并进行配置；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%205.png)

## 1.3 Keil软件入门

打开生成的工程，keil 界面如图所示，其中 1 为调试模式，2 为编译改变的文件，3 为编
译全部的文件，4 为下载按键，5 为工程设置选项，6 为工程目录；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%206.png)

点击编译按钮对工程进行编译，一般我们需要编译改变的文件，这样编译速度会快一点。编译结果也会在下方窗口显示，一般来说新建的工程是没有bug的，所以显示0 Error 0 Warning

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%207.png)

编译完成后我们需要烧录和调试，下面需要配置调试模式。首先我们进行工程相关设置，先点击魔术棒，在弹出的窗口中选择 Output，其中 Create HEX file 为是否生成HEX 文件，Browse Information 为是否增加浏览信息，选择是，可以使用鼠标右键点击函数进行跳转操作，但会增加编译时长；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%208.png)

点击 C/C++，其中 1 方框为工程宏定义设置，可在此添加宏定义；2 方框为头文件引用目
录，对于项目自行建立的 h 文件需要在此处进行目录录入；

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%209.png)

点击 Debug 选项，根据你手头的烧录器型号设置好对应的烧录器选项，一般来说DAP-Link和ST-Link较为常用，无线烧录器一般来说都是DAP-Link。

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%2010.png)

根据原理图可以知道烧录端口引脚从Pin1到Pin4分别为SWDIO、SWCLK、GND、VCC，我们连接调试器的时候只需要一一对应就行了

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%2011.png)

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled.jpeg)

将烧录器插上电脑，按照以下步骤依次点击查看连接情况，若显示芯片序列号，则代表芯片连接成功，可以进行下一步的烧录或调试，否则需要检查连线或者是检查是否有其他故障。

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%2012.png)

点击Load按钮，等待几秒钟，如果烧录成功将输出窗口出现以下字样“Flash Load finished at xx:xx:xx”;

![Untitled](/%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85+%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE+%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%2086e602a36cbb4cc79cd77dc66fa95855/Untitled%2013.png)

到此，你已经完成了工程的创建和烧录。

## 1.4 Vscode 配置STM32编程环境

由于Keil软件界面丑陋，操作不方便，但是又因为他的适用性很好，我们不得不使用该软件进行嵌入式开发。所以我们想着有什么办法可以让开发变得容易。于是我们选择使用Vscode进行代码编写和编译，使用Keil进行Debug调试，这样两大软件的优势就结合起来了。

配置方法请见该篇博客：

[如何利用VScode打造优雅的STM32开发环境(超详细，新手向)——Keil Assistant插件-CSDN博客](https://blog.csdn.net/weixin_43395116/article/details/114238722?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171316191316800225560660%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171316191316800225560660&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-114238722-null-null.142^v100^pc_search_result_base8&utm_term=keil%20assistant&spm=1018.2226.3001.4187)

# 二、基于Arm-gcc+CubeMX+Clion的工具链

参考稚晖君的教程就可以了

[配置CLion用于STM32开发【优雅の嵌入式开发】 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/145801160)

也可以参考Clion哥的教程

[ARM嵌入式学习笔记（1）使用CUBEMX图形化配置工具和CLION进行嵌入式开发-CSDN博客](https://blog.csdn.net/qq_61508022/article/details/136666081?spm=1001.2014.3001.5501)